DROP TABLE IF EXISTS users;
CREATE TABLE users
(
    user_id    INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    first_name VARCHAR(128),
    last_name  VARCHAR(128),
    user_name  VARCHAR(128),
    password   VARCHAR(255),
    is_active  BOOLEAN,
    criteria   VARCHAR(255)
);

DROP TABLE IF EXISTS trainer;
CREATE TABLE trainer
(
    trainer_id        INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    specialization_id INTEGER,
    user_id           INTEGER,
    trainee_id INTEGER,
    training_id INTEGER
);

DROP TABLE IF EXISTS specialization;
CREATE TABLE specialization
(
    specialization_id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    speciality        VARCHAR(255)
);

DROP TABLE IF EXISTS trainee;
CREATE TABLE trainee
(
    trainee_id    INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    date_of_birth DATE,
    address       VARCHAR(255),
    user_id       INTEGER,
    trainers      VARCHAR(120),
    is_assigned BOOLEAN,
    trainings     VARCHAR(255)
);

DROP TABLE IF EXISTS training;
CREATE TABLE training
(
    training_id       INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    trainee_id        INTEGER,
    trainer_id        INTEGER,
    training_name     VARCHAR(255),
    training_type  VARCHAR(100),
    training_date     DATE,
    training_duration bytea
);

DROP TABLE IF EXISTS training_type;
CREATE TABLE training_type
(
    training_type_id   INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    training_type_name VARCHAR(120)
);

CREATE RULE training_type_no_update AS ON UPDATE TO training_type DO INSTEAD NOTHING;

DROP TABLE IF EXISTS users_trainer;
CREATE TABLE users_trainer
(
    trainer_id INTEGER,
    user_id    INTEGER,
    PRIMARY KEY (trainer_id, user_id),
    FOREIGN KEY (trainer_id) REFERENCES trainer (trainer_id) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users (user_id) ON DELETE CASCADE ON UPDATE CASCADE
);

DROP TABLE IF EXISTS users_trainee;
CREATE TABLE users_trainee
(
    trainee_id INTEGER,
    user_id    INTEGER,
    PRIMARY KEY (trainee_id, user_id),
    FOREIGN KEY (trainee_id) REFERENCES trainee (trainee_id) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users (user_id) ON DELETE CASCADE ON UPDATE CASCADE
);

DROP TABLE IF EXISTS trainer_trainee;
CREATE TABLE trainer_trainee
(
    trainee_id INTEGER,
    trainer_id INTEGER,
    PRIMARY KEY (trainee_id, trainer_id),
    FOREIGN KEY (trainee_id) REFERENCES trainee (trainee_id) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (trainer_id) REFERENCES trainer (trainer_id) ON DELETE CASCADE ON UPDATE CASCADE
);

DROP TABLE IF EXISTS trainee_training;
CREATE TABLE trainee_training
(
    trainee_id  INTEGER,
    training_id INTEGER,
    PRIMARY KEY (trainee_id, training_id),
    FOREIGN KEY (trainee_id) REFERENCES trainee (trainee_id) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (training_id) REFERENCES training (training_id) ON DELETE CASCADE ON UPDATE CASCADE
);

DROP TABLE IF EXISTS trainer_training;
CREATE TABLE trainer_training
(
    trainer_id  INTEGER,
    training_id INTEGER,
    PRIMARY KEY (trainer_id, training_id),
    FOREIGN KEY (trainer_id) REFERENCES trainer (trainer_id) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (training_id) REFERENCES training (training_id) ON DELETE CASCADE ON UPDATE CASCADE
);